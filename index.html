<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BestFishingSecrets — Feed</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f1a33; --text:#e8edf7; --muted:#b7c0d6; --line:#223152;
      --accent:#60a5fa;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:var(--text)}
    header{padding:18px 16px;border-bottom:1px solid var(--line);background:var(--card);position:sticky;top:0;z-index:5}
    h1{margin:0;font-size:18px}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .status{padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:var(--card);margin-bottom:12px;color:var(--muted);white-space:pre-wrap}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    button,input,select,textarea{font:inherit}
    button{
      border:1px solid var(--line);background:var(--card);color:var(--text);
      padding:10px 12px;border-radius:12px;cursor:pointer
    }
    button:hover{filter:brightness(1.1)}
    button:disabled{opacity:.55;cursor:not-allowed}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
    .card{border:1px solid var(--line);border-radius:16px;background:var(--card);padding:14px}
    .title{font-weight:800;margin:0 0 6px;font-size:16px}
    .meta{color:var(--muted);font-size:13px;margin:0 0 10px}
    .price{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#0b1220;font-weight:800}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .form{
      border:1px solid var(--line);
      border-radius:16px;
      background:var(--card);
      padding:14px;
      margin-bottom:14px;
    }
    .form h2{margin:0 0 10px;font-size:15px}
    .fields{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    .fields .full{grid-column:1 / -1}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input,select,textarea{
      width:100%;
      border:1px solid var(--line);
      background:#0b1220;
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }
    textarea{min-height:90px;resize:vertical}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
    .danger{color:#fecaca}
    .ok{color:#bbf7d0}

    /* Image styling */
    .post-img{
      width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      display:block;
      margin:0 0 10px 0;
      background:#0b1220;
    }
    .img-note{font-size:12px;color:var(--muted);margin-top:6px}
    @media (max-width:720px){
      .fields{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header><h1>BestFishingSecrets — Live Feed</h1></header>

  <div class="wrap">
    <div id="status" class="status">Loading…</div>

    <!-- Auth row gets inserted here by JS -->

    <!-- Post a Catch form -->
    <div class="form">
      <h2>Post a Catch</h2>
      <div class="fields">
        <div>
          <label for="title">Title</label>
          <input id="title" placeholder="e.g., 5lb bass at dawn" />
        </div>

        <div>
          <label for="state">State</label>
          <select id="state">
            <option value="">Select a state…</option>
            <option>Alabama</option><option>Alaska</option><option>Arizona</option><option>Arkansas</option>
            <option>California</option><option>Colorado</option><option>Connecticut</option><option>Delaware</option>
            <option>Florida</option><option>Georgia</option><option>Hawaii</option><option>Idaho</option>
            <option>Illinois</option><option>Indiana</option><option>Iowa</option><option>Kansas</option>
            <option>Kentucky</option><option>Louisiana</option><option>Maine</option><option>Maryland</option>
            <option>Massachusetts</option><option>Michigan</option><option>Minnesota</option><option>Mississippi</option>
            <option>Missouri</option><option>Montana</option><option>Nebraska</option><option>Nevada</option>
            <option>New Hampshire</option><option>New Jersey</option><option>New Mexico</option><option>New York</option>
            <option>North Carolina</option><option>North Dakota</option><option>Ohio</option><option>Oklahoma</option>
            <option>Oregon</option><option>Pennsylvania</option><option>Rhode Island</option><option>South Carolina</option>
            <option>South Dakota</option><option>Tennessee</option><option>Texas</option><option>Utah</option>
            <option>Vermont</option><option>Virginia</option><option>Washington</option><option>West Virginia</option>
            <option>Wisconsin</option><option>Wyoming</option>
          </select>
        </div>

        <div>
          <label for="price">Price (USD)</label>
          <input id="price" type="number" step="0.01" min="0" placeholder="9.99" />
        </div>

        <div>
          <label for="previewUrl">Preview link (optional)</label>
          <input id="previewUrl" placeholder="https://..." />
        </div>

        <div class="full">
          <label for="fullUrl">Full link (optional)</label>
          <input id="fullUrl" placeholder="https://..." />
        </div>

        <!-- ✅ NEW: Photo upload -->
        <div class="full">
          <label for="photo">Photo (uploaded to Cloudinary)</label>
          <input id="photo" type="file" accept="image/*" />
          <div class="img-note">Optional, but recommended. JPG/PNG/HEIC should work. Large files may take longer on mobile.</div>
        </div>

        <div class="full">
          <label for="secretLocation">Secret location (stored, not displayed)</label>
          <textarea id="secretLocation" placeholder="Example: Lake name, GPS pin, access details…"></textarea>
          <div class="hint">For now we store this field in Firestore. Later we’ll “lock” it so only buyers can see it.</div>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="postBtn" disabled>Sign in to post</button>
        <button id="reloadBtn" type="button">Reload posts</button>
      </div>
      <div class="hint">Posting is disabled until you sign in.</div>
    </div>

    <!-- Feed -->
    <div id="grid" class="grid"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      serverTimestamp,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    // ✅ Cloudinary config (NO secrets needed for unsigned upload)
    const CLOUDINARY_CLOUD_NAME = "dhuakqubc";
    const CLOUDINARY_UPLOAD_PRESET = "emiktt1b";
    const CLOUDINARY_UPLOAD_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;

    // ✅ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCndtMlIb_Y_YCP1RO-ctfizRU6q1MGeHY",
      authDomain: "bestfishingsecrets-932cf.firebaseapp.com",
      projectId: "bestfishingsecrets-932cf",
      storageBucket: "bestfishingsecrets-932cf.firebasestorage.app",
      messagingSenderId: "387299114354",
      appId: "1:387299114354:web:cbadda074f9dd7083ef1eb",
      measurementId: "G-Z8L28MXNEG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const statusEl = document.getElementById("status");
    const gridEl = document.getElementById("grid");

    const titleEl = document.getElementById("title");
    const stateEl = document.getElementById("state");
    const priceEl = document.getElementById("price");
    const previewUrlEl = document.getElementById("previewUrl");
    const fullUrlEl = document.getElementById("fullUrl");
    const secretLocationEl = document.getElementById("secretLocation");

    // ✅ NEW: photo input
    const photoEl = document.getElementById("photo");

    const postBtn = document.getElementById("postBtn");
    const reloadBtn = document.getElementById("reloadBtn");

    // Insert Auth UI just below status box
    const authRow = document.createElement("div");
    authRow.className = "row";
    authRow.innerHTML = `
      <button id="loginBtn" type="button">Sign in with Google</button>
      <button id
